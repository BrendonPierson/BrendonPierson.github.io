<!doctype html><html lang=en-us><head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-F1YSMHGEC0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>DISTINCT FROM to compare NULL-able values in Postgres &#183; Biersons</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=Biersons></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>Biersons</h2></a><ul><li><a href=/about/><span>About</span></a></li><li><a href=/posts/><span>Posts</span></a></li></ul></div></nav><main><div class=post><div class=post-info><span>Written by</span>
Brendon Pierson<br><span>on&nbsp;</span><time datetime="2022-12-19 06:45:24 -0500 -0500">December 19, 2022</time></div><h1 class=post-title>DISTINCT FROM to compare NULL-able values in Postgres</h1><div class=post-line></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-F1YSMHGEC0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F1YSMHGEC0",{anonymize_ip:!1})}</script><p>It turns out I&rsquo;ve been comparing potentially null values in postgres the wrong way for years. Any comparisons will a null value result in null so <code>null &lt;> 3</code> isn&rsquo;t <code>true</code> it&rsquo;s <code>null</code>. To avoid this I would do something like <code>coalesce(potentially_null_field, 0) &lt;> 3</code> when I could have instead done <code>potentially_null_field IS DISTINCT FROM 3</code>.</p><p>For example I want to find books written by authors from a different country and include results where country is listed on the author or book, but null on the other table. The query coalesces the potentially null <code>country</code> field on each table to an empty string so that if one is null <code>null &lt;> 'USA'</code> will be <code>true</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  books b
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>JOIN</span> authors a <span style=color:#66d9ef>on</span> a.id <span style=color:#f92672>=</span> book.author_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> coalesce(b.country, <span style=color:#e6db74>&#39;&#39;</span>) <span style=color:#f92672>&lt;&gt;</span> coalesce(a.country, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span></code></pre></div><p>I should have written it</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  books b
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>JOIN</span> authors a <span style=color:#66d9ef>on</span> a.id <span style=color:#f92672>=</span> book.author_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> b.country <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>DISTINCT</span> <span style=color:#66d9ef>FROM</span> a.country
</span></span></code></pre></div><p><a href=https://www.postgresql.org/docs/current/functions-comparison.html>IS DISTINCT FROM</a> Will treat <code>null &lt;> 'USA'</code> as <code>TRUE</code> and <code>null &lt;> null</code> as <code>FALSE</code>. Not only is the syntax clearer, there are potential performance gains as <code>coalesce</code> can cause index misses in some situations.</p></div><div class=pagination><a href=/posts/sagemaker-aurora-terraform/ class="left arrow">&#8592;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2022-12-19 12:31:48.247862059 +0000 UTC m=+0.066374098">2022</time> Brendon Pierson. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>